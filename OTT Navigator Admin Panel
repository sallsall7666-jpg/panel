import React, { useState, useEffect } from 'react';
import { Home, Users, DollarSign, Package, List, Tv, Smartphone, Activity, Settings, LogOut, Plus, Edit2, Trash2, Search, Download, Eye, Key, Upload, FileText, Link2, BarChart3, CheckSquare } from 'lucide-react';

const OTTNavigatorPanel = () => {
  const [currentPage, setCurrentPage] = useState('dashboard');
  const [users, setUsers] = useState([]);
  const [resellers, setResellers] = useState([]);
  const [packages, setPackages] = useState([]);
  const [playlists, setPlaylists] = useState([]);
  const [channels, setChannels] = useState([]);
  const [userAgents, setUserAgents] = useState([]);
  const [activityLogs, setActivityLogs] = useState([]);
  const [userSessions, setUserSessions] = useState([]);
  const [selectedUsers, setSelectedUsers] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [stats, setStats] = useState({
    totalUsers: 0,
    activeUsers: 0,
    totalResellers: 0,
    totalRevenue: 0,
    todayCreated: 0,
    monthlyCreated: 0
  });

  useEffect(() => {
    loadData();
  }, []);

  const loadData = () => {
    const savedUsers = JSON.parse(localStorage.getItem('ott_users') || '[]');
    const savedResellers = JSON.parse(localStorage.getItem('ott_resellers') || '[]');
    const savedPackages = JSON.parse(localStorage.getItem('ott_packages') || '[]');
    const savedPlaylists = JSON.parse(localStorage.getItem('ott_playlists') || '[]');
    const savedChannels = JSON.parse(localStorage.getItem('ott_channels') || '[]');
    const savedUserAgents = JSON.parse(localStorage.getItem('ott_user_agents') || '[]');
    const savedLogs = JSON.parse(localStorage.getItem('ott_activity_logs') || '[]');
    const savedSessions = JSON.parse(localStorage.getItem('ott_user_sessions') || '[]');

    setUsers(savedUsers);
    setResellers(savedResellers);
    setPackages(savedPackages);
    setPlaylists(savedPlaylists);
    setChannels(savedChannels);
    setUserAgents(savedUserAgents);
    setActivityLogs(savedLogs);
    setUserSessions(savedSessions);

    updateStats(savedUsers, savedResellers);
  };

  const updateStats = (usersList, resellersList) => {
    const today = new Date().toDateString();
    const thisMonth = new Date().getMonth();
    
    const todayUsers = usersList.filter(u => new Date(u.createdAt).toDateString() === today).length;
    const monthlyUsers = usersList.filter(u => new Date(u.createdAt).getMonth() === thisMonth).length;
    const activeUsers = usersList.filter(u => u.status === 'active').length;

    setStats({
      totalUsers: usersList.length,
      activeUsers: activeUsers,
      totalResellers: resellersList.length,
      totalRevenue: usersList.reduce((sum, u) => sum + (u.revenue || 0), 0),
      todayCreated: todayUsers,
      monthlyCreated: monthlyUsers
    });
  };

  const addLog = (action, details) => {
    const log = {
      id: Date.now(),
      action,
      details,
      timestamp: new Date().toISOString(),
      user: 'Admin'
    };
    const newLogs = [log, ...activityLogs].slice(0, 100);
    setActivityLogs(newLogs);
    localStorage.setItem('ott_activity_logs', JSON.stringify(newLogs));
  };

  // Export All Data
  const exportAllData = () => {
    const allData = {
      users, resellers, packages, playlists, channels, 
      userAgents, activityLogs, userSessions,
      exportDate: new Date().toISOString()
    };
    const dataStr = JSON.stringify(allData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `ott_backup_${Date.now()}.json`;
    link.click();
    addLog('Data Exported', 'All panel data exported successfully');
  };

  // Import Data
  const importData = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result);
          if (confirm('Import data akan overwrite semua data sedia ada. Teruskan?')) {
            setUsers(data.users || []);
            setResellers(data.resellers || []);
            setPackages(data.packages || []);
            setPlaylists(data.playlists || []);
            setChannels(data.channels || []);
            setUserAgents(data.userAgents || []);
            setActivityLogs(data.activityLogs || []);
            setUserSessions(data.userSessions || []);
            
            localStorage.setItem('ott_users', JSON.stringify(data.users || []));
            localStorage.setItem('ott_resellers', JSON.stringify(data.resellers || []));
            localStorage.setItem('ott_packages', JSON.stringify(data.packages || []));
            localStorage.setItem('ott_playlists', JSON.stringify(data.playlists || []));
            localStorage.setItem('ott_channels', JSON.stringify(data.channels || []));
            localStorage.setItem('ott_user_agents', JSON.stringify(data.userAgents || []));
            localStorage.setItem('ott_activity_logs', JSON.stringify(data.activityLogs || []));
            localStorage.setItem('ott_user_sessions', JSON.stringify(data.userSessions || []));
            
            updateStats(data.users || [], data.resellers || []);
            addLog('Data Imported', 'Panel data imported successfully');
            alert('Data berjaya diimport!');
          }
        } catch (error) {
          alert('Error importing data: ' + error.message);
        }
      };
      reader.readAsText(file);
    }
  };

  // Generate M3U Playlist for User
  const generateM3U = (user) => {
    let m3uContent = '#EXTM3U\n';
    m3uContent += `#EXTINF:-1 tvg-logo="" group-title="User: ${user.username}",OTT Navigator\n`;
    
    channels.forEach(channel => {
      m3uContent += `#EXTINF:-1 tvg-id="${channel.epgId}" tvg-logo="${channel.logo}" group-title="${channel.category}",${channel.name}\n`;
      m3uContent += `${channel.streamUrl}\n`;
    });

    const blob = new Blob([m3uContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `${user.username}_playlist.m3u`;
    link.click();
    addLog('Playlist Generated', `M3U playlist generated for ${user.username}`);
  };

  // Dashboard Component
  const Dashboard = () => (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h2 className="text-2xl font-bold text-white">Dashboard Overview</h2>
        <div className="flex gap-2">
          <button 
            onClick={exportAllData}
            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Download size={18} /> Export Data
          </button>
          <label className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 cursor-pointer">
            <Upload size={18} /> Import Data
            <input type="file" accept=".json" onChange={importData} className="hidden" />
          </label>
        </div>
      </div>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard 
          title="Online Users" 
          value={stats.activeUsers} 
          icon={<Users />} 
          color="bg-blue-600"
          subtitle={`${stats.totalUsers} total`}
        />
        <StatCard 
          title="Created Today" 
          value={stats.todayCreated} 
          icon={<Plus />} 
          color="bg-cyan-600"
          subtitle="New registrations"
        />
        <StatCard 
          title="This Month" 
          value={stats.monthlyCreated} 
          icon={<Activity />} 
          color="bg-orange-600"
          subtitle="Monthly growth"
        />
        <StatCard 
          title="Total Revenue" 
          value={`RM ${stats.totalRevenue.toFixed(2)}`} 
          icon={<DollarSign />} 
          color="bg-green-600"
          subtitle="Cumulative earnings"
        />
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="bg-gray-800 rounded-lg p-6">
          <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <BarChart3 size={20} /> Quick Stats
          </h3>
          <div className="space-y-3">
            <StatRow label="Total Users" value={stats.totalUsers} color="text-blue-400" />
            <StatRow label="Active Users" value={stats.activeUsers} color="text-green-400" />
            <StatRow label="Expired Users" value={users.filter(u => u.status === 'expired').length} color="text-red-400" />
            <StatRow label="Total Resellers" value={stats.totalResellers} color="text-purple-400" />
            <StatRow label="Total Packages" value={packages.length} color="text-yellow-400" />
            <StatRow label="Total Channels" value={channels.length} color="text-pink-400" />
            <StatRow label="Active Sessions" value={userSessions.length} color="text-cyan-400" />
          </div>
        </div>

        <div className="lg:col-span-2 bg-gray-800 rounded-lg p-6">
          <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <Activity size={20} /> Recent Activity
          </h3>
          <div className="space-y-2 max-h-80 overflow-y-auto">
            {activityLogs.slice(0, 15).map(log => (
              <div key={log.id} className="text-sm border-b border-gray-700 pb-2">
                <div className="flex justify-between items-start">
                  <div>
                    <div className="font-semibold text-white">{log.action}</div>
                    <div className="text-gray-400">{log.details}</div>
                  </div>
                  <div className="text-xs text-gray-500">{new Date(log.timestamp).toLocaleTimeString()}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-gray-800 rounded-lg p-6">
          <h3 className="text-lg font-semibold text-white mb-4">Package Distribution</h3>
          <div className="space-y-3">
            {packages.map(pkg => {
              const count = users.filter(u => u.package === pkg.name).length;
              const percentage = stats.totalUsers > 0 ? (count / stats.totalUsers * 100).toFixed(1) : 0;
              return (
                <div key={pkg.id}>
                  <div className="flex justify-between text-sm text-gray-300 mb-1">
                    <span>{pkg.name}</span>
                    <span>{count} users ({percentage}%)</span>
                  </div>
                  <div className="w-full bg-gray-700 rounded-full h-2">
                    <div className="bg-blue-600 h-2 rounded-full" style={{width: `${percentage}%`}}></div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        <div className="bg-gray-800 rounded-lg p-6">
          <h3 className="text-lg font-semibold text-white mb-4">Expiring Soon</h3>
          <div className="space-y-2">
            {users
              .filter(u => {
                const daysLeft = Math.ceil((new Date(u.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                return daysLeft > 0 && daysLeft <= 7;
              })
              .slice(0, 5)
              .map(u => {
                const daysLeft = Math.ceil((new Date(u.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                return (
                  <div key={u.id} className="flex justify-between items-center text-sm border-b border-gray-700 pb-2">
                    <span className="text-gray-300">{u.username}</span>
                    <span className="text-orange-400">{daysLeft} days left</span>
                  </div>
                );
              })}
          </div>
        </div>
      </div>
    </div>
  );

  const StatCard = ({ title, value, icon, color, subtitle }) => (
    <div className={`${color} rounded-lg p-6 text-white shadow-lg`}>
      <div className="flex items-center justify-between">
        <div>
          <p className="text-sm opacity-90">{title}</p>
          <p className="text-3xl font-bold mt-2">{value}</p>
          {subtitle && <p className="text-xs opacity-75 mt-1">{subtitle}</p>}
        </div>
        <div className="opacity-80">
          {React.cloneElement(icon, { size: 40 })}
        </div>
      </div>
    </div>
  );

  const StatRow = ({ label, value, color }) => (
    <div className="flex justify-between items-center">
      <span className="text-gray-300">{label}:</span>
      <span className={`font-semibold ${color}`}>{value}</span>
    </div>
  );

  // Users Management with Bulk Actions
  const UsersManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [editingUser, setEditingUser] = useState(null);
    const [formData, setFormData] = useState({
      username: '', email: '', password: '', package: '', status: 'active', 
      expiryDate: '', maxConnections: 1, revenue: 0
    });

    const filteredUsers = users.filter(u => 
      u.username.toLowerCase().includes(searchTerm.toLowerCase()) ||
      u.email.toLowerCase().includes(searchTerm.toLowerCase())
    );

    const handleSubmit = (e) => {
      e.preventDefault();
      if (editingUser) {
        const updated = users.map(u => u.id === editingUser.id ? { ...formData, id: u.id, createdAt: u.createdAt } : u);
        setUsers(updated);
        localStorage.setItem('ott_users', JSON.stringify(updated));
        addLog('User Updated', `Updated user: ${formData.username}`);
      } else {
        const newUser = { ...formData, id: Date.now(), createdAt: new Date().toISOString() };
        const updated = [...users, newUser];
        setUsers(updated);
        localStorage.setItem('ott_users', JSON.stringify(updated));
        addLog('User Created', `Created new user: ${formData.username}`);
      }
      updateStats(users, resellers);
      setShowForm(false);
      setEditingUser(null);
      setFormData({ username: '', email: '', password: '', package: '', status: 'active', expiryDate: '', maxConnections: 1, revenue: 0 });
    };

    const deleteUser = (id) => {
      if (confirm('Anda pasti mahu delete user ini?')) {
        const updated = users.filter(u => u.id !== id);
        setUsers(updated);
        localStorage.setItem('ott_users', JSON.stringify(updated));
        addLog('User Deleted', `Deleted user ID: ${id}`);
        updateStats(updated, resellers);
      }
    };

    const bulkDelete = () => {
      if (selectedUsers.length === 0) {
        alert('Sila pilih user untuk delete');
        return;
      }
      if (confirm(`Delete ${selectedUsers.length} users?`)) {
        const updated = users.filter(u => !selectedUsers.includes(u.id));
        setUsers(updated);
        localStorage.setItem('ott_users', JSON.stringify(updated));
        addLog('Bulk Delete', `Deleted ${selectedUsers.length} users`);
        setSelectedUsers([]);
        updateStats(updated, resellers);
      }
    };

    const bulkExtend = () => {
      if (selectedUsers.length === 0) {
        alert('Sila pilih user untuk extend');
        return;
      }
      const days = prompt('Berapa hari nak extend?');
      if (days) {
        const updated = users.map(u => {
          if (selectedUsers.includes(u.id)) {
            const newDate = new Date(u.expiryDate);
            newDate.setDate(newDate.getDate() + parseInt(days));
            return { ...u, expiryDate: newDate.toISOString().split('T')[0] };
          }
          return u;
        });
        setUsers(updated);
        localStorage.setItem('ott_users', JSON.stringify(updated));
        addLog('Bulk Extend', `Extended ${selectedUsers.length} users by ${days} days`);
        setSelectedUsers([]);
      }
    };

    const toggleSelectUser = (id) => {
      setSelectedUsers(prev => 
        prev.includes(id) ? prev.filter(uid => uid !== id) : [...prev, id]
      );
    };

    const toggleSelectAll = () => {
      setSelectedUsers(prev => 
        prev.length === filteredUsers.length ? [] : filteredUsers.map(u => u.id)
      );
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center flex-wrap gap-4">
          <h2 className="text-2xl font-bold text-white">Users Management ({filteredUsers.length})</h2>
          <div className="flex gap-2 flex-wrap">
            <input
              type="text"
              placeholder="Search users..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="bg-gray-700 text-white px-4 py-2 rounded-lg"
            />
            <button 
              onClick={() => setShowForm(!showForm)}
              className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
            >
              <Plus size={20} /> Add User
            </button>
          </div>
        </div>

        {selectedUsers.length > 0 && (
          <div className="bg-gray-800 p-4 rounded-lg flex gap-2 flex-wrap items-center">
            <span className="text-white">{selectedUsers.length} selected</span>
            <button onClick={bulkExtend} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
              Extend Expiry
            </button>
            <button onClick={bulkDelete} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
              Delete Selected
            </button>
            <button onClick={() => setSelectedUsers([])} className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
              Clear Selection
            </button>
          </div>
        )}

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input
                type="text"
                placeholder="Username"
                value={formData.username}
                onChange={(e) => setFormData({...formData, username: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="email"
                placeholder="Email"
                value={formData.email}
                onChange={(e) => setFormData({...formData, email: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="password"
                placeholder="Password"
                value={formData.password}
                onChange={(e) => setFormData({...formData, password: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <select
                value={formData.package}
                onChange={(e) => setFormData({...formData, package: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              >
                <option value="">Select Package</option>
                {packages.map(pkg => (
                  <option key={pkg.id} value={pkg.name}>{pkg.name}</option>
                ))}
              </select>
              <input
                type="date"
                placeholder="Expiry Date"
                value={formData.expiryDate}
                onChange={(e) => setFormData({...formData, expiryDate: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <select
                value={formData.status}
                onChange={(e) => setFormData({...formData, status: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
              >
                <option value="active">Active</option>
                <option value="expired">Expired</option>
                <option value="suspended">Suspended</option>
              </select>
              <input
                type="number"
                placeholder="Max Connections"
                value={formData.maxConnections}
                onChange={(e) => setFormData({...formData, maxConnections: parseInt(e.target.value)})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                min="1"
              />
              <input
                type="number"
                placeholder="Revenue (RM)"
                value={formData.revenue}
                onChange={(e) => setFormData({...formData, revenue: parseFloat(e.target.value)})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                min="0"
                step="0.01"
              />
            </div>
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                {editingUser ? 'Update' : 'Create'} User
              </button>
              <button 
                type="button" 
                onClick={() => {
                  setShowForm(false);
                  setEditingUser(null);
                  setFormData({ username: '', email: '', password: '', package: '', status: 'active', expiryDate: '', maxConnections: 1, revenue: 0 });
                }}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}

        <div className="bg-gray-800 rounded-lg overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-700">
                <tr>
                  <th className="px-4 py-3 text-left">
                    <input
                      type="checkbox"
                      checked={selectedUsers.length === filteredUsers.length && filteredUsers.length > 0}
                      onChange={toggleSelectAll}
                      className="w-4 h-4"
                    />
                  </th>
                  <th className="px-4 py-3 text-left text-white">Username</th>
                  <th className="px-4 py-3 text-left text-white">Email</th>
                  <th className="px-4 py-3 text-left text-white">Package</th>
                  <th className="px-4 py-3 text-left text-white">Status</th>
                  <th className="px-4 py-3 text-left text-white">Expiry</th>
                  <th className="px-4 py-3 text-left text-white">Actions</th>
                </tr>
              </thead>
              <tbody>
                {filteredUsers.map(user => (
                  <tr key={user.id} className="border-b border-gray-700 hover:bg-gray-750">
                    <td className="px-4 py-3">
                      <input
                        type="checkbox"
                        checked={selectedUsers.includes(user.id)}
                        onChange={() => toggleSelectUser(user.id)}
                        className="w-4 h-4"
                      />
                    </td>
                    <td className="px-4 py-3 text-gray-300">{user.username}</td>
                    <td className="px-4 py-3 text-gray-300">{user.email}</td>
                    <td className="px-4 py-3 text-gray-300">{user.package}</td>
                    <td className="px-4 py-3">
                      <span className={`px-2 py-1 rounded text-xs ${
                        user.status === 'active' ? 'bg-green-600' : 
                        user.status === 'expired' ? 'bg-red-600' : 'bg-yellow-600'
                      }`}>
                        {user.status}
                      </span>
                    </td>
                    <td className="px-4 py-3 text-gray-300">{user.expiryDate}</td>
                    <td className="px-4 py-3">
                      <div className="flex gap-2">
                        <button 
                          onClick={() => generateM3U(user)}
                          className="text-green-400 hover:text-green-300"
                          title="Generate M3U"
                        >
                          <Download size={18} />
                        </button>
                        <button 
                          onClick={() => {
                            setEditingUser(user);
                            setFormData(user);
                            setShowForm(true);
                          }}
                          className="text-blue-400 hover:text-blue-300"
                          title="Edit"
                        >
                          <Edit2 size={18} />
                        </button>
                        <button 
                          onClick={() => deleteUser(user.id)}
                          className="text-red-400 hover:text-red-300"
                          title="Delete"
                        >
                          <Trash2 size={18} />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // API Generator
  const APIGenerator = () => {
    const [selectedUser, setSelectedUser] = useState('');
    const baseUrl = window.location.origin;

    const generateAPIURL = () => {
      if (!selectedUser) return '';
      const user = users.find(u => u.id === parseInt(selectedUser));
      if (!user) return '';
      return `${baseUrl}/api/playlist/${user.username}?auth=${btoa(user.username + ':' + user.password)}`;
    };

    const generateXtreamCodes = () => {
      if (!selectedUser) return '';
      const user = users.find(u => u.id === parseInt(selectedUser));
      if (!user) return '';
      return {
        server: baseUrl,
        username: user.username,
        password: user.password,
        fullUrl: `${baseUrl}/player_api.php?username=${user.username}&password=${user.password}`
      };
    };

    return (
      <div className="space-y-4">
        <h2 className="text-2xl font-bold text-white">API Generator</h2>
        
        <div className="bg-gray-800 rounded-lg p-6 space-y-4">
          <div>
            <label className="block text-gray-300 mb-2">Select User</label>
            <select
              value={selectedUser}
              onChange={(e) => setSelectedUser(e.target.value)}
              className="w-full bg-gray-700 text-white px-4 py-2 rounded"
            >
              <option value="">Choose a user...</option>
              {users.map(user => (
                <option key={user.id} value={user.id}>{user.username} ({user.email})</option>
              ))}
            </select>
          </div>

          {selectedUser && (
            <>
              <div>
                <label className="block text-gray-300 mb-2 font-semibold">M3U Playlist URL</label>
                <div className="bg-gray-700 p-3 rounded text-gray-300 break-all">
                  {generateAPIURL()}
                </div>
                <button 
                  onClick={() => {
                    navigator.clipboard.writeText(generateAPIURL());
                    alert('URL copied to clipboard!');
                  }}
                  className="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
                >
                  Copy URL
                </button>
              </div>

              <div>
                <label className="block text-gray-300 mb-2 font-semibold">Xtream Codes API</label>
                <div className="bg-gray-700 p-3 rounded text-gray-300 space-y-2">
                  <div><strong>Server:</strong> {generateXtreamCodes().server}</div>
                  <div><strong>Username:</strong> {generateXtreamCodes().username}</div>
                  <div><strong>Password:</strong> {generateXtreamCodes().password}</div>
                  <div className="pt-2 border-t border-gray-600">
                    <strong>Full URL:</strong><br/>
                    <span className="text-sm break-all">{generateXtreamCodes().fullUrl}</span>
                  </div>
                </div>
                <button 
                  onClick={() => {
                    const info = generateXtreamCodes();
                    const text = `Server: ${info.server}\nUsername: ${info.username}\nPassword: ${info.password}\nFull URL: ${info.fullUrl}`;
                    navigator.clipboard.writeText(text);
                    alert('Xtream codes copied to clipboard!');
                  }}
                  className="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
                >
                  Copy Credentials
                </button>
              </div>
            </>
          )}
        </div>
      </div>
    );
  };

  // Resellers Management
  const ResellersManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [formData, setFormData] = useState({
      username: '', email: '', password: '', credits: 0, commission: 0
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      const newReseller = { ...formData, id: Date.now(), createdAt: new Date().toISOString() };
      const updated = [...resellers, newReseller];
      setResellers(updated);
      localStorage.setItem('ott_resellers', JSON.stringify(updated));
      addLog('Reseller Created', `Created new reseller: ${formData.username}`);
      updateStats(users, updated);
      setShowForm(false);
      setFormData({ username: '', email: '', password: '', credits: 0, commission: 0 });
    };

    const deleteReseller = (id) => {
      if (confirm('Delete reseller ini?')) {
        const updated = resellers.filter(r => r.id !== id);
        setResellers(updated);
        localStorage.setItem('ott_resellers', JSON.stringify(updated));
        addLog('Reseller Deleted', `Deleted reseller ID: ${id}`);
        updateStats(users, updated);
      }
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Resellers Management</h2>
          <button 
            onClick={() => setShowForm(!showForm)}
            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Plus size={20} /> Add Reseller
          </button>
        </div>

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input
                type="text"
                placeholder="Username"
                value={formData.username}
                onChange={(e) => setFormData({...formData, username: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="email"
                placeholder="Email"
                value={formData.email}
                onChange={(e) => setFormData({...formData, email: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="password"
                placeholder="Password"
                value={formData.password}
                onChange={(e) => setFormData({...formData, password: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="number"
                placeholder="Credits"
                value={formData.credits}
                onChange={(e) => setFormData({...formData, credits: parseInt(e.target.value)})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                min="0"
              />
              <input
                type="number"
                placeholder="Commission %"
                value={formData.commission}
                onChange={(e) => setFormData({...formData, commission: parseFloat(e.target.value)})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                min="0"
                max="100"
                step="0.1"
              />
            </div>
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                Create Reseller
              </button>
              <button 
                type="button"
                onClick={() => setShowForm(false)}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}

        <div className="bg-gray-800 rounded-lg overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-700">
              <tr>
                <th className="px-4 py-3 text-left text-white">Username</th>
                <th className="px-4 py-3 text-left text-white">Email</th>
                <th className="px-4 py-3 text-left text-white">Credits</th>
                <th className="px-4 py-3 text-left text-white">Commission</th>
                <th className="px-4 py-3 text-left text-white">Created</th>
                <th className="px-4 py-3 text-left text-white">Actions</th>
              </tr>
            </thead>
            <tbody>
              {resellers.map(reseller => (
                <tr key={reseller.id} className="border-b border-gray-700">
                  <td className="px-4 py-3 text-gray-300">{reseller.username}</td>
                  <td className="px-4 py-3 text-gray-300">{reseller.email}</td>
                  <td className="px-4 py-3 text-gray-300">{reseller.credits}</td>
                  <td className="px-4 py-3 text-gray-300">{reseller.commission}%</td>
                  <td className="px-4 py-3 text-gray-300">{new Date(reseller.createdAt).toLocaleDateString()}</td>
                  <td className="px-4 py-3">
                    <button 
                      onClick={() => deleteReseller(reseller.id)}
                      className="text-red-400 hover:text-red-300"
                    >
                      <Trash2 size={18} />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  // Packages Management
  const PackagesManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [formData, setFormData] = useState({
      name: '', duration: '', price: 0, connections: 1, description: ''
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      const newPackage = { ...formData, id: Date.now() };
      const updated = [...packages, newPackage];
      setPackages(updated);
      localStorage.setItem('ott_packages', JSON.stringify(updated));
      addLog('Package Created', `Created new package: ${formData.name}`);
      setShowForm(false);
      setFormData({ name: '', duration: '', price: 0, connections: 1, description: '' });
    };

    const deletePackage = (id) => {
      if (confirm('Delete package ini?')) {
        const updated = packages.filter(p => p.id !== id);
        setPackages(updated);
        localStorage.setItem('ott_packages', JSON.stringify(updated));
        addLog('Package Deleted', `Deleted package ID: ${id}`);
      }
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Packages Management</h2>
          <button 
            onClick={() => setShowForm(!showForm)}
            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Plus size={20} /> Add Package
          </button>
        </div>

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input
                type="text"
                placeholder="Package Name"
                value={formData.name}
                onChange={(e) => setFormData({...formData, name: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <select
                value={formData.duration}
                onChange={(e) => setFormData({...formData, duration: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              >
                <option value="">Select Duration</option>
                <option value="1 Month">1 Month</option>
                <option value="3 Months">3 Months</option>
                <option value="6 Months">6 Months</option>
                <option value="1 Year">1 Year</option>
              </select>
              <input
                type="number"
                placeholder="Price (RM)"
                value={formData.price}
                onChange={(e) => setFormData({...formData, price: parseFloat(e.target.value)})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                min="0"
                step="0.01"
                required
              />
              <input
                type="number"
                placeholder="Max Connections"
                value={formData.connections}
                onChange={(e) => setFormData({...formData, connections: parseInt(e.target.value)})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                min="1"
                required
              />
            </div>
            <textarea
              placeholder="Description"
              value={formData.description}
              onChange={(e) => setFormData({...formData, description: e.target.value})}
              className="w-full bg-gray-700 text-white px-4 py-2 rounded"
              rows="3"
            />
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                Create Package
              </button>
              <button 
                type="button"
                onClick={() => setShowForm(false)}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {packages.map(pkg => (
            <div key={pkg.id} className="bg-gray-800 rounded-lg p-6 relative">
              <button 
                onClick={() => deletePackage(pkg.id)}
                className="absolute top-4 right-4 text-red-400 hover:text-red-300"
              >
                <Trash2 size={18} />
              </button>
              <h3 className="text-xl font-bold text-white mb-2">{pkg.name}</h3>
              <p className="text-gray-400 mb-4">{pkg.description}</p>
              <div className="space-y-2 text-gray-300">
                <div className="flex justify-between">
                  <span>Duration:</span>
                  <span className="font-semibold">{pkg.duration}</span>
                </div>
                <div className="flex justify-between">
                  <span>Price:</span>
                  <span className="font-semibold text-green-400">RM {pkg.price}</span>
                </div>
                <div className="flex justify-between">
                  <span>Connections:</span>
                  <span className="font-semibold">{pkg.connections}</span>
                </div>
                <div className="flex justify-between pt-2 border-t border-gray-700">
                  <span>Active Users:</span>
                  <span className="font-semibold text-blue-400">
                    {users.filter(u => u.package === pkg.name).length}
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  };

  // Playlists Management
  const PlaylistsManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [formData, setFormData] = useState({
      name: '', url: '', type: 'M3U', category: ''
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      const newPlaylist = { ...formData, id: Date.now(), createdAt: new Date().toISOString() };
      const updated = [...playlists, newPlaylist];
      setPlaylists(updated);
      localStorage.setItem('ott_playlists', JSON.stringify(updated));
      addLog('Playlist Created', `Created new playlist: ${formData.name}`);
      setShowForm(false);
      setFormData({ name: '', url: '', type: 'M3U', category: '' });
    };

    const deletePlaylist = (id) => {
      if (confirm('Delete playlist ini?')) {
        const updated = playlists.filter(p => p.id !== id);
        setPlaylists(updated);
        localStorage.setItem('ott_playlists', JSON.stringify(updated));
        addLog('Playlist Deleted', `Deleted playlist ID: ${id}`);
      }
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Playlists Management</h2>
          <button 
            onClick={() => setShowForm(!showForm)}
            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Plus size={20} /> Add Playlist
          </button>
        </div>

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input
                type="text"
                placeholder="Playlist Name"
                value={formData.name}
                onChange={(e) => setFormData({...formData, name: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="url"
                placeholder="Playlist URL"
                value={formData.url}
                onChange={(e) => setFormData({...formData, url: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <select
                value={formData.type}
                onChange={(e) => setFormData({...formData, type: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
              >
                <option value="M3U">M3U</option>
                <option value="M3U8">M3U8</option>
                <option value="XSPF">XSPF</option>
              </select>
              <input
                type="text"
                placeholder="Category"
                value={formData.category}
                onChange={(e) => setFormData({...formData, category: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
              />
            </div>
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                Create Playlist
              </button>
              <button 
                type="button"
                onClick={() => setShowForm(false)}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}

        <div className="bg-gray-800 rounded-lg overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-700">
              <tr>
                <th className="px-4 py-3 text-left text-white">Name</th>
                <th className="px-4 py-3 text-left text-white">Type</th>
                <th className="px-4 py-3 text-left text-white">Category</th>
                <th className="px-4 py-3 text-left text-white">URL</th>
                <th className="px-4 py-3 text-left text-white">Actions</th>
              </tr>
            </thead>
            <tbody>
              {playlists.map(playlist => (
                <tr key={playlist.id} className="border-b border-gray-700">
                  <td className="px-4 py-3 text-gray-300">{playlist.name}</td>
                  <td className="px-4 py-3 text-gray-300">{playlist.type}</td>
                  <td className="px-4 py-3 text-gray-300">{playlist.category}</td>
                  <td className="px-4 py-3 text-gray-300 truncate max-w-xs">{playlist.url}</td>
                  <td className="px-4 py-3">
                    <div className="flex gap-2">
                      <button 
                        onClick={() => window.open(playlist.url, '_blank')}
                        className="text-blue-400 hover:text-blue-300"
                      >
                        <Download size={18} />
                      </button>
                      <button 
                        onClick={() => deletePlaylist(playlist.id)}
                        className="text-red-400 hover:text-red-300"
                      >
                        <Trash2 size={18} />
                      </button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  // Channels Management
  const ChannelsManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [formData, setFormData] = useState({
      name: '', category: '', streamUrl: '', logo: '', epgId: ''
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      const newChannel = { ...formData, id: Date.now() };
      const updated = [...channels, newChannel];
      setChannels(updated);
      localStorage.setItem('ott_channels', JSON.stringify(updated));
      addLog('Channel Added', `Added new channel: ${formData.name}`);
      setShowForm(false);
      setFormData({ name: '', category: '', streamUrl: '', logo: '', epgId: '' });
    };

    const deleteChannel = (id) => {
      if (confirm('Delete channel ini?')) {
        const updated = channels.filter(c => c.id !== id);
        setChannels(updated);
        localStorage.setItem('ott_channels', JSON.stringify(updated));
        addLog('Channel Deleted', `Deleted channel ID: ${id}`);
      }
    };

    const categoryColors = {
      'Sports': 'bg-red-600',
      'Movies': 'bg-purple-600',
      'News': 'bg-blue-600',
      'Entertainment': 'bg-pink-600',
      'Kids': 'bg-yellow-600',
      'Documentary': 'bg-green-600'
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Channels Management ({channels.length})</h2>
          <button 
            onClick={() => setShowForm(!showForm)}
            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Plus size={20} /> Add Channel
          </button>
        </div>

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input
                type="text"
                placeholder="Channel Name"
                value={formData.name}
                onChange={(e) => setFormData({...formData, name: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <select
                value={formData.category}
                onChange={(e) => setFormData({...formData, category: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              >
                <option value="">Select Category</option>
                <option value="Sports">Sports</option>
                <option value="Movies">Movies</option>
                <option value="News">News</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Kids">Kids</option>
                <option value="Documentary">Documentary</option>
              </select>
              <input
                type="url"
                placeholder="Stream URL"
                value={formData.streamUrl}
                onChange={(e) => setFormData({...formData, streamUrl: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="url"
                placeholder="Logo URL"
                value={formData.logo}
                onChange={(e) => setFormData({...formData, logo: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
              />
              <input
                type="text"
                placeholder="EPG ID"
                value={formData.epgId}
                onChange={(e) => setFormData({...formData, epgId: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
              />
            </div>
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                Add Channel
              </button>
              <button 
                type="button"
                onClick={() => setShowForm(false)}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          {channels.map(channel => (
            <div key={channel.id} className="bg-gray-800 rounded-lg p-4 hover:bg-gray-750 transition">
              <div className="flex items-start justify-between mb-3">
                <div className="flex items-center gap-3">
                  {channel.logo && (
                    <img src={channel.logo} alt={channel.name} className="w-12 h-12 rounded object-cover" />
                  )}
                  <div>
                    <h3 className="text-white font-semibold">{channel.name}</h3>
                    <span className={`text-xs px-2 py-1 rounded ${categoryColors[channel.category] || 'bg-gray-600'}`}>
                      {channel.category}
                    </span>
                  </div>
                </div>
                <button 
                  onClick={() => deleteChannel(channel.id)}
                  className="text-red-400 hover:text-red-300"
                >
                  <Trash2 size={16} />
                </button>
              </div>
              <div className="text-xs text-gray-400 space-y-1">
                <div className="truncate">URL: {channel.streamUrl}</div>
                {channel.epgId && <div>EPG: {channel.epgId}</div>}
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  };

  // User Agents Management
  const UserAgentsManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [formData, setFormData] = useState({
      username: '', device: '', ipAddress: '', location: ''
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      const newAgent = { ...formData, id: Date.now(), connectedAt: new Date().toISOString() };
      const updated = [...userAgents, newAgent];
      setUserAgents(updated);
      localStorage.setItem('ott_user_agents', JSON.stringify(updated));
      addLog('Device Tracked', `Device tracked for user: ${formData.username}`);
      setShowForm(false);
      setFormData({ username: '', device: '', ipAddress: '', location: '' });
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Device Tracking</h2>
          <button 
            onClick={() => setShowForm(!showForm)}
            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Plus size={20} /> Track Device
          </button>
        </div>

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <select
                value={formData.username}
                onChange={(e) => setFormData({...formData, username: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              >
                <option value="">Select User</option>
                {users.map(user => (
                  <option key={user.id} value={user.username}>{user.username}</option>
                ))}
              </select>
              <select
                value={formData.device}
                onChange={(e) => setFormData({...formData, device: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              >
                <option value="">Select Device</option>
                <option value="Android TV">Android TV</option>
                <option value="Fire TV">Fire TV</option>
                <option value="Smart TV">Smart TV</option>
                <option value="Mobile Android">Mobile Android</option>
                <option value="Mobile iOS">Mobile iOS</option>
                <option value="STB">Set-Top Box</option>
                <option value="Web Browser">Web Browser</option>
              </select>
              <input
                type="text"
                placeholder="IP Address"
                value={formData.ipAddress}
                onChange={(e) => setFormData({...formData, ipAddress: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="text"
                placeholder="Location (e.g. Malaysia, Kuala Lumpur)"
                value={formData.location}
                onChange={(e) => setFormData({...formData, location: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
              />
            </div>
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                Track Device
              </button>
              <button 
                type="button"
                onClick={() => setShowForm(false)}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}

        <div className="bg-gray-800 rounded-lg overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-700">
              <tr>
                <th className="px-4 py-3 text-left text-white">Username</th>
                <th className="px-4 py-3 text-left text-white">Device</th>
                <th className="px-4 py-3 text-left text-white">IP Address</th>
                <th className="px-4 py-3 text-left text-white">Location</th>
                <th className="px-4 py-3 text-left text-white">Connected At</th>
              </tr>
            </thead>
            <tbody>
              {userAgents.map(agent => (
                <tr key={agent.id} className="border-b border-gray-700">
                  <td className="px-4 py-3 text-gray-300">{agent.username}</td>
                  <td className="px-4 py-3 text-gray-300 flex items-center gap-2">
                    <Smartphone size={16} className="text-blue-400" />
                    {agent.device}
                  </td>
                  <td className="px-4 py-3 text-gray-300">{agent.ipAddress}</td>
                  <td className="px-4 py-3 text-gray-300">{agent.location || 'Unknown'}</td>
                  <td className="px-4 py-3 text-gray-300">{new Date(agent.connectedAt).toLocaleString()}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  // Activity Logs
  const ActivityLogsManagement = () => {
    const [filter, setFilter] = useState('all');

    const filteredLogs = filter === 'all' 
      ? activityLogs 
      : activityLogs.filter(log => log.action.toLowerCase().includes(filter.toLowerCase()));

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Activity Logs ({filteredLogs.length})</h2>
          <select
            value={filter}
            onChange={(e) => setFilter(e.target.value)}
            className="bg-gray-700 text-white px-4 py-2 rounded"
          >
            <option value="all">All Activities</option>
            <option value="user">User Activities</option>
            <option value="reseller">Reseller Activities</option>
            <option value="package">Package Activities</option>
            <option value="channel">Channel Activities</option>
          </select>
        </div>
        
        <div className="bg-gray-800 rounded-lg overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-700">
              <tr>
                <th className="px-4 py-3 text-left text-white">Timestamp</th>
                <th className="px-4 py-3 text-left text-white">User</th>
                <th className="px-4 py-3 text-left text-white">Action</th>
                <th className="px-4 py-3 text-left text-white">Details</th>
              </tr>
            </thead>
            <tbody>
              {filteredLogs.map(log => (
                <tr key={log.id} className="border-b border-gray-700">
                  <td className="px-4 py-3 text-gray-300 text-sm">{new Date(log.timestamp).toLocaleString()}</td>
                  <td className="px-4 py-3 text-gray-300">{log.user}</td>
                  <td className="px-4 py-3">
                    <span className="px-2 py-1 bg-blue-600 rounded text-xs text-white">
                      {log.action}
                    </span>
                  </td>
                  <td className="px-4 py-3 text-gray-300">{log.details}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  // User Sessions
  const UserSessionsManagement = () => {
    const [showForm, setShowForm] = useState(false);
    const [formData, setFormData] = useState({
      username: '', ipAddress: '', device: '', loginTime: new Date().toISOString().slice(0, 16)
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      const newSession = { ...formData, id: Date.now(), status: 'active' };
      const updated = [...userSessions, newSession];
      setUserSessions(updated);
      localStorage.setItem('ott_user_sessions', JSON.stringify(updated));
      addLog('Session Started', `New session for user: ${formData.username}`);
      setShowForm(false);
      setFormData({ username: '', ipAddress: '', device: '', loginTime: new Date().toISOString().slice(0, 16) });
    };

    const terminateSession = (id) => {
      if (confirm('Terminate session ini?')) {
        const updated = userSessions.filter(s => s.id !== id);
        setUserSessions(updated);
        localStorage.setItem('ott_user_sessions', JSON.stringify(updated));
        addLog('Session Terminated', `Terminated session ID: ${id}`);
      }
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h2 className="text-2xl font-bold text-white">Active Sessions ({userSessions.length})</h2>
          <button 
            onClick={() => setShowForm(!showForm)}
            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
          >
            <Plus size={20} /> Add Session
          </button>
        </div>

        {showForm && (
          <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-lg space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <select
                value={formData.username}
                onChange={(e) => setFormData({...formData, username: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              >
                <option value="">Select User</option>
                {users.map(user => (
                  <option key={user.id} value={user.username}>{user.username}</option>
                ))}
              </select>
              <input
                type="text"
                placeholder="IP Address"
                value={formData.ipAddress}
                onChange={(e) => setFormData({...formData, ipAddress: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="text"
                placeholder="Device"
                value={formData.device}
                onChange={(e) => setFormData({...formData, device: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
              <input
                type="datetime-local"
                value={formData.loginTime}
                onChange={(e) => setFormData({...formData, loginTime: e.target.value})}
                className="bg-gray-700 text-white px-4 py-2 rounded"
                required
              />
            </div>
            <div className="flex gap-2">
              <button type="submit" className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
                Create Session
              </button>
              <button 
                type="button"
                onClick={() => setShowForm(false)}
                className="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded"
              >
                Cancel
              </button>
            </div>
          </form>
        )}
        
        <div className="bg-gray-800 rounded-lg overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-700">
              <tr>
                <th className="px-4 py-3 text-left text-white">Username</th>
                <th className="px-4 py-3 text-left text-white">IP Address</th>
                <th className="px-4 py-3 text-left text-white">Device</th>
                <th className="px-4 py-3 text-left text-white">Login Time</th>
                <th className="px-4 py-3 text-left text-white">Status</th>
                <th className="px-4 py-3 text-left text-white">Actions</th>
              </tr>
            </thead>
            <tbody>
              {userSessions.map(session => (
                <tr key={session.id} className="border-b border-gray-700">
                  <td className="px-4 py-3 text-gray-300">{session.username}</td>
                  <td className="px-4 py-3 text-gray-300">{session.ipAddress}</td>
                  <td className="px-4 py-3 text-gray-300">{session.device}</td>
                  <td className="px-4 py-3 text-gray-300">{new Date(session.loginTime).toLocaleString()}</td>
                  <td className="px-4 py-3">
                    <span className="px-2 py-1 bg-green-600 rounded text-xs">
                      {session.status}
                    </span>
                  </td>
                  <td className="px-4 py-3">
                    <button 
                      onClick={() => terminateSession(session.id)}
                      className="text-red-400 hover:text-red-300"
                    >
                      <Trash2 size={18} />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  // Settings
  const SettingsManagement = () => {
    const [settings, setSettings] = useState(() => {
      const saved = localStorage.getItem('ott_settings');
      return saved ? JSON.parse(saved) : {
        panelName: 'OTT Navigator Panel',
        supportEmail: 'support@ottnavigator.com',
        apiKey: '',
        maxConnections: 2,
        autoRenew: true,
        maintenanceMode: false,
        serverUrl: window.location.origin,
        currency: 'RM'
      };
    });

    const handleSave = () => {
      localStorage.setItem('ott_settings', JSON.stringify(settings));
      addLog('Settings Updated', 'Panel settings have been updated');
      alert('Settings saved successfully!');
    };

    const clearAllData = () => {
      if (confirm(' AMARAN: Ini akan delete SEMUA data termasuk users, resellers, packages, channels, etc. Anda pasti?')) {
        if (confirm('Confirm sekali lagi. Data tidak boleh dikembalikan!')) {
          localStorage.clear();
          setUsers([]);
          setResellers([]);
          setPackages([]);
          setPlaylists([]);
          setChannels([]);
          setUserAgents([]);
          setActivityLogs([]);
          setUserSessions([]);
          updateStats([], []);
          alert('Semua data telah dihapuskan!');
        }
      }
    };

    return (
      <div className="space-y-4">
        <h2 className="text-2xl font-bold text-white">Panel Settings</h2>
        
        <div className="bg-gray-800 rounded-lg p-6 space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-gray-300 mb-2">Panel Name</label>
              <input
                type="text"
                value={settings.panelName}
                onChange={(e) => setSettings({...settings, panelName: e.target.value})}
                className="w-full bg-gray-700 text-white px-4 py-2 rounded"
              />
            </div>

            <div>
              <label className="block text-gray-300 mb-2">Support Email</label>
              <input
                type="email"
                value={settings.supportEmail}
                onChange={(e) => setSettings({...settings, supportEmail: e.target.value})}
                className="w-full bg-gray-700 text-white px-4 py-2 rounded"
              />
            </div>

            <div>
              <label className="block text-gray-300 mb-2">Server URL</label>
              <input
                type="text"
                value={settings.serverUrl}
                onChange={(e) => setSettings({...settings, serverUrl: e.target.value})}
                className="w-full bg-gray-700 text-white px-4 py-2 rounded"
              />
            </div>

            <div>
              <label className="block text-gray-300 mb-2">Currency</label>
              <select
                value={settings.currency}
                onChange={(e) => setSettings({...settings, currency: e.target.value})}
                className="w-full bg-gray-700 text-white px-4 py-2 rounded"
              >
                <option value="RM">RM (Ringgit Malaysia)</option>
                <option value="USD">USD (US Dollar)</option>
                <option value="EUR">EUR (Euro)</option>
                <option value="GBP">GBP (British Pound)</option>
              </select>
            </div>

            <div>
              <label className="block text-gray-300 mb-2">API Key</label>
              <input
                type="text"
                value={settings.apiKey}
                onChange={(e) => setSettings({...settings, apiKey: e.target.value})}
                className="w-full bg-gray-700 text-white px-4 py-2 rounded"
                placeholder="Enter API Key"
              />
            </div>

            <div>
              <label className="block text-gray-300 mb-2">Default Max Connections</label>
              <input
                type="number"
                value={settings.maxConnections}
                onChange={(e) => setSettings({...settings, maxConnections: parseInt(e.target.value)})}
                className="w-full bg-gray-700 text-white px-4 py-2 rounded"
                min="1"
              />
            </div>
          </div>

          <div className="space-y-3 pt-4 border-t border-gray-700">
            <div className="flex items-center gap-3">
              <input
                type="checkbox"
                id="autoRenew"
                checked={settings.autoRenew}
                onChange={(e) => setSettings({...settings, autoRenew: e.target.checked})}
                className="w-5 h-5"
              />
              <label htmlFor="autoRenew" className="text-gray-300">Enable Auto-Renew for Subscriptions</label>
            </div>

            <div className="flex items-center gap-3">
              <input
                type="checkbox"
                id="maintenanceMode"
                checked={settings.maintenanceMode}
                onChange={(e) => setSettings({...settings, maintenanceMode: e.target.checked})}
                className="w-5 h-5"
              />
              <label htmlFor="maintenanceMode" className="text-gray-300">Maintenance Mode</label>
            </div>
          </div>

          <div className="flex gap-2 pt-4">
            <button 
              onClick={handleSave}
              className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded"
            >
              Save Settings
            </button>
            <button 
              onClick={clearAllData}
              className="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded"
            >
              Clear All Data
            </button>
          </div>
        </div>

        <div className="bg-gray-800 rounded-lg p-6">
          <h3 className="text-lg font-semibold text-white mb-4">System Information</h3>
          <div className="space-y-2 text-gray-300">
            <div className="flex justify-between">
              <span>Total Users:</span>
              <span className="font-semibold">{users.length}</span>
            </div>
            <div className="flex justify-between">
              <span>Total Resellers:</span>
              <span className="font-semibold">{resellers.length}</span>
            </div>
            <div className="flex justify-between">
              <span>Total Packages:</span>
              <span className="font-semibold">{packages.length}</span>
            </div>
            <div className="flex justify-between">
              <span>Total Channels:</span>
              <span className="font-semibold">{channels.length}</span>
            </div>
            <div className="flex justify-between">
              <span>Total Playlists:</span>
              <span className="font-semibold">{playlists.length}</span>
            </div>
            <div className="flex justify-between">
              <span>Activity Logs:</span>
              <span className="font-semibold">{activityLogs.length}</span>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Main Render
  return (
    <div className="min-h-screen bg-gray-900">
      {/* Mobile Header */}
      <div className="lg:hidden fixed top-0 left-0 right-0 bg-gray-800 border-b border-gray-700 p-4 z-50 flex items-center justify-between">
        <h1 className="text-xl font-bold text-white">OTT Navigator</h1>
        <button 
          onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
          className="text-white p-2"
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            {isMobileMenuOpen ? (
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            ) : (
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
            )}
          </svg>
        </button>
      </div>

      {/* Sidebar */}
      <div className={`fixed left-0 top-0 h-full w-64 bg-gray-800 border-r border-gray-700 overflow-y-auto z-50 transition-transform duration-300 ${
        isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'
      }`}>
        <div className="p-6 pt-20 lg:pt-6">
          <h1 className="text-2xl font-bold text-white mb-2 hidden lg:block">OTT Navigator</h1>
          <p className="text-xs text-gray-400 mb-6 hidden lg:block">Admin Panel v1.0</p>
          
          <nav className="space-y-2">
            <NavItem 
              icon={<Home size={20} />} 
              label="Dashboard" 
              active={currentPage === 'dashboard'}
              onClick={() => {
                setCurrentPage('dashboard');
                setIsMobileMenuOpen(false);
              }}
            />
            <NavItem 
              icon={<Users size={20} />} 
              label="Users" 
              active={currentPage === 'users'}
              onClick={() => {
                setCurrentPage('users');
                setIsMobileMenuOpen(false);
              }}
              badge={users.length}
            />
            <NavItem 
              icon={<DollarSign size={20} />} 
              label="Resellers" 
              active={currentPage === 'resellers'}
              onClick={() => {
                setCurrentPage('resellers');
                setIsMobileMenuOpen(false);
              }}
              badge={resellers.length}
            />
            <NavItem 
              icon={<Package size={20} />} 
              label="Packages" 
              active={currentPage === 'packages'}
              onClick={() => {
                setCurrentPage('packages');
                setIsMobileMenuOpen(false);
              }}
              badge={packages.length}
            />
            <NavItem 
              icon={<List size={20} />} 
              label="Playlists" 
              active={currentPage === 'playlists'}
              onClick={() => {
                setCurrentPage('playlists');
                setIsMobileMenuOpen(false);
              }}
              badge={playlists.length}
            />
            <NavItem 
              icon={<Tv size={20} />} 
              label="Channels" 
              active={currentPage === 'channels'}
              onClick={() => {
                setCurrentPage('channels');
                setIsMobileMenuOpen(false);
              }}
              badge={channels.length}
            />
            <NavItem 
              icon={<Smartphone size={20} />} 
              label="User Agents" 
              active={currentPage === 'user_agents'}
              onClick={() => {
                setCurrentPage('user_agents');
                setIsMobileMenuOpen(false);
              }}
            />
            <NavItem 
              icon={<Activity size={20} />} 
              label="Activity Logs" 
              active={currentPage === 'activity_logs'}
              onClick={() => {
                setCurrentPage('activity_logs');
                setIsMobileMenuOpen(false);
              }}
            />
            <NavItem 
              icon={<Key size={20} />} 
              label="Sessions" 
              active={currentPage === 'sessions'}
              onClick={() => {
                setCurrentPage('sessions');
                setIsMobileMenuOpen(false);
              }}
              badge={userSessions.length}
            />
            <NavItem 
              icon={<Link2 size={20} />} 
              label="API Generator" 
              active={currentPage === 'api'}
              onClick={() => {
                setCurrentPage('api');
                setIsMobileMenuOpen(false);
              }}
            />
            <NavItem 
              icon={<Settings size={20} />} 
              label="Settings" 
              active={currentPage === 'settings'}
              onClick={() => {
                setCurrentPage('settings');
                setIsMobileMenuOpen(false);
              }}
            />
          </nav>
        </div>
      </div>

      {/* Mobile Menu Overlay */}
      {isMobileMenuOpen && (
        <div 
          className="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40"
          onClick={() => setIsMobileMenuOpen(false)}
        />
      )}

      {/* Main Content */}
      <div className="lg:ml-64 pt-20 lg:pt-0 p-4 lg:p-8">
        {currentPage === 'dashboard' && <Dashboard />}
        {currentPage === 'users' && <UsersManagement />}
        {currentPage === 'resellers' && <ResellersManagement />}
        {currentPage === 'packages' && <PackagesManagement />}
        {currentPage === 'playlists' && <PlaylistsManagement />}
        {currentPage === 'channels' && <ChannelsManagement />}
        {currentPage === 'user_agents' && <UserAgentsManagement />}
        {currentPage === 'activity_logs' && <ActivityLogsManagement />}
        {currentPage === 'sessions' && <UserSessionsManagement />}
        {currentPage === 'api' && <APIGenerator />}
        {currentPage === 'settings' && <SettingsManagement />}
      </div>
    </div>
  );
};

const NavItem = ({ icon, label, active, onClick, badge }) => (
  <button
    onClick={onClick}
    className={`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-colors ${
      active 
        ? 'bg-blue-600 text-white' 
        : 'text-gray-300 hover:bg-gray-700'
    }`}
  >
    <div className="flex items-center gap-3">
      {icon}
      <span>{label}</span>
    </div>
    {badge !== undefined && (
      <span className={`text-xs px-2 py-1 rounded-full ${
        active ? 'bg-blue-700' : 'bg-gray-700'
      }`}>
        {badge}
      </span>
    )}
  </button>
);

export default OTTNavigatorPanel;
